<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نبيل لوكر - نظام التخزين الدائم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f1f5f9;
        }
        .custom-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .animate-pop {
            animation: pop 0.3s ease-out;
        }
        @keyframes pop {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="text-slate-900 overflow-x-hidden">

    <div id="app" class="max-w-4xl mx-auto p-4 md:p-8 space-y-6">
        
        <!-- Header -->
        <header class="bg-white p-6 rounded-3xl border border-slate-200 custom-shadow flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="bg-indigo-600 p-4 rounded-2xl shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                </div>
                <div>
                    <h1 class="text-3xl font-black text-slate-800">نبيل لوكر</h1>
                    <div class="flex items-center gap-2 text-emerald-600 text-sm font-bold">
                        <span class="relative flex h-2 w-2">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                        </span>
                        التخزين السحابي المحلي مفعل
                    </div>
                </div>
            </div>
            <div class="bg-slate-900 text-white px-6 py-3 rounded-2xl font-bold text-center">
                <div class="text-[10px] text-slate-400 uppercase">إجمالي المخزون</div>
                <span id="total-count" class="text-xl">0</span>
            </div>
        </header>

        <!-- Input Section -->
        <section class="bg-white p-6 rounded-3xl border border-slate-200 custom-shadow space-y-5">
            <div class="flex items-center justify-between">
                <h2 class="font-black text-xl flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-600"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                    إضافة حسابات جديدة
                </h2>
                <span id="save-status" class="text-xs font-bold text-slate-400">بانتظار البيانات...</span>
            </div>

            <div class="grid grid-cols-3 gap-2">
                <button onclick="changeTab('general')" id="tab-general" class="tab-btn py-3 rounded-xl border-2 border-indigo-600 bg-indigo-50 text-indigo-700 font-bold text-sm">عام</button>
                <button onclick="changeTab('go')" id="tab-go" class="tab-btn py-3 rounded-xl border-2 border-slate-100 bg-slate-50 text-slate-500 font-bold text-sm">GO</button>
                <button onclick="changeTab('work')" id="tab-work" class="tab-btn py-3 rounded-xl border-2 border-slate-100 bg-slate-50 text-slate-500 font-bold text-sm">مساحة عمل</button>
            </div>

            <textarea id="main-input" class="w-full h-40 p-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 outline-none transition-all font-mono text-sm" placeholder="انسخ الحسابات هنا..."></textarea>
            
            <button onclick="processInput()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black text-lg hover:bg-indigo-700 shadow-lg shadow-indigo-100 active:scale-95 transition-all">
                حفظ في مخزن <span id="current-tab-name">العام</span>
            </button>
        </section>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white p-6 rounded-3xl border border-slate-200 text-center space-y-3">
                <div class="text-indigo-600 font-black">المخزن العام</div>
                <div id="c-general" class="text-3xl font-black text-slate-800">0</div>
                <button onclick="pullAccount('general')" class="w-full bg-slate-100 hover:bg-indigo-600 hover:text-white py-2 rounded-xl font-bold transition-all">سحب</button>
            </div>
            <div class="bg-white p-6 rounded-3xl border border-slate-200 text-center space-y-3">
                <div class="text-emerald-600 font-black">اشتراك GO</div>
                <div id="c-go" class="text-3xl font-black text-slate-800">0</div>
                <button onclick="pullAccount('go')" class="w-full bg-slate-100 hover:bg-emerald-600 hover:text-white py-2 rounded-xl font-bold transition-all">سحب</button>
            </div>
            <div class="bg-white p-6 rounded-3xl border border-slate-200 text-center space-y-3">
                <div class="text-blue-600 font-black">مساحة العمل</div>
                <div id="c-work" class="text-3xl font-black text-slate-800">0</div>
                <button onclick="pullAccount('work')" class="w-full bg-slate-100 hover:bg-blue-600 hover:text-white py-2 rounded-xl font-bold transition-all">سحب</button>
            </div>
        </div>

        <!-- Result -->
        <div id="display-area" class="hidden animate-pop">
            <div class="bg-white rounded-3xl border-4 border-slate-900 overflow-hidden shadow-2xl">
                <div class="bg-slate-900 p-4 text-white flex justify-between items-center">
                    <span class="font-bold flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-400"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        تم سحب الحساب بنجاح
                    </span>
                    <button onclick="closeResult()" class="text-slate-400 hover:text-white">إغلاق</button>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase">Login</label>
                        <div class="flex items-center gap-2 bg-slate-50 p-3 rounded-xl border border-slate-100">
                            <span id="out-login" class="flex-1 font-mono text-sm truncate select-all">---</span>
                            <button onclick="copy('out-login')" class="text-indigo-600"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg></button>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase">Password</label>
                        <div class="flex items-center gap-2 bg-slate-50 p-3 rounded-xl border border-slate-100">
                            <span id="out-pass" class="flex-1 font-mono text-sm truncate select-all">---</span>
                            <button onclick="copy('out-pass')" class="text-indigo-600"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg></button>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase">Recovery</label>
                        <div class="flex items-center gap-2 bg-slate-50 p-3 rounded-xl border border-slate-100">
                            <span id="out-recovery" class="flex-1 font-mono text-sm truncate select-all">---</span>
                            <button onclick="copy('out-recovery')" class="text-indigo-600"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg></button>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase">Action</label>
                        <a id="out-link" href="#" target="_blank" class="flex items-center justify-center gap-2 bg-indigo-600 text-white p-3 rounded-xl font-bold text-sm hover:bg-indigo-700 transition-all">
                            فتح رابط الرسائل
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <button onclick="fullReset()" class="w-full text-slate-300 hover:text-rose-500 text-xs font-bold transition-all">مسح جميع بيانات نبيل لوكر نهائياً</button>

    </div>

    <script>
        // توحيد مفتاح التخزين لضمان عدم الضياع
        const STORAGE_KEY = 'NABIL_LOCKER_VAULT_PRO';
        let activeTab = 'general';
        let db = { general: [], go: [], work: [] };

        // 1. القراءة عند تشغيل الموقع
        window.addEventListener('DOMContentLoaded', () => {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
                try {
                    db = JSON.parse(raw);
                    console.log("Data loaded successfully");
                } catch (e) {
                    console.error("Data corruption, resetting...");
                    save(); // إعادة تعيين التخزين في حال الخطأ
                }
            }
            refreshUI();
        });

        function changeTab(t) {
            activeTab = t;
            const names = { general: 'العام', go: 'اشتراك GO', work: 'مساحة العمل' };
            document.getElementById('current-tab-name').innerText = names[t];
            
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.className = "tab-btn py-3 rounded-xl border-2 border-slate-100 bg-slate-50 text-slate-500 font-bold text-sm";
            });
            
            const activeColors = { 
                general: 'border-indigo-600 bg-indigo-50 text-indigo-700',
                go: 'border-emerald-600 bg-emerald-50 text-emerald-700',
                work: 'border-blue-600 bg-blue-50 text-blue-700'
            };
            document.getElementById('tab-' + t).className = "tab-btn py-3 rounded-xl border-2 font-bold text-sm " + activeColors[t];
        }

        function processInput() {
            const val = document.getElementById('main-input').value.trim();
            if (!val) return;

            const lines = val.split('\n');
            let added = 0;
            
            lines.forEach(line => {
                if (line.includes(';')) {
                    const [l, p, r, u] = line.split(';');
                    db[activeTab].push({ login: l, pass: p, recovery: r, url: u });
                    added++;
                }
            });

            if (added > 0) {
                document.getElementById('main-input').value = '';
                save();
                refreshUI();
                showStatus(`تمت إضافة ${added} حساب بنجاح`);
            }
        }

        function pullAccount(cat) {
            if (db[cat].length === 0) {
                showStatus("هذا المخزن فارغ!");
                return;
            }

            const item = db[cat].shift(); // سحب وحذف
            
            // عرض النتائج
            document.getElementById('display-area').classList.remove('hidden');
            document.getElementById('out-login').innerText = item.login || '---';
            document.getElementById('out-pass').innerText = item.pass || '---';
            document.getElementById('out-recovery').innerText = item.recovery || '---';
            document.getElementById('out-link').href = item.url || '#';

            save();
            refreshUI();
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function save() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
        }

        function refreshUI() {
            document.getElementById('c-general').innerText = db.general.length;
            document.getElementById('c-go').innerText = db.go.length;
            document.getElementById('c-work').innerText = db.work.length;
            document.getElementById('total-count').innerText = db.general.length + db.go.length + db.work.length;
        }

        function copy(id) {
            const txt = document.getElementById(id).innerText;
            const el = document.createElement('textarea');
            el.value = txt;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showStatus("تم النسخ!");
        }

        function showStatus(msg) {
            const s = document.getElementById('save-status');
            s.innerText = msg;
            s.classList.replace('text-slate-400', 'text-indigo-600');
            setTimeout(() => {
                s.innerText = "التخزين آمن";
                s.classList.replace('text-indigo-600', 'text-slate-400');
            }, 3000);
        }

        function closeResult() {
            document.getElementById('display-area').classList.add('hidden');
        }

        function fullReset() {
            if (confirm("سيتم حذف كل شيء من نبيل لوكر، هل أنت متأكد؟")) {
                db = { general: [], go: [], work: [] };
                save();
                refreshUI();
                location.reload();
            }
        }
    </script>
</body>
</html>

